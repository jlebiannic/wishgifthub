openapi: 3.0.3
info:
  title: WishGiftHub API
  description: |
    API REST pour la gestion d'événements et de listes de souhaits.
    
    ## Fonctionnalités principales
    - Authentification des administrateurs et utilisateurs invités
    - Gestion des groupes d'événements (Noël)
    - Système d'invitations par email
    - Gestion des listes de souhaits
    - Réservation de cadeaux
    
    ## Sécurité
    - Authentification JWT pour tous les endpoints protégés
    - Les administrateurs peuvent créer et gérer des groupes
    - Les utilisateurs invités accèdent via un token d'invitation unique

  version: 1.0.0
  contact:
    name: WishGiftHub Team
servers:
  - url: http://localhost:8080
    description: Serveur de développement local
  - url: https://api.wishgifthub.com
    description: Serveur de production

tags:
  - name: Authentification
    description: Endpoints pour l'inscription et la connexion des administrateurs
  - name: Groupes
    description: Gestion des groupes d'événements
  - name: Invitations
    description: Création et acceptation d'invitations
  - name: Utilisateurs
    description: Consultation des groupes et membres
  - name: Souhaits
    description: Gestion des listes de souhaits et réservations

security:
  - bearerAuth: []

paths:
  # Authentication endpoints
  /api/auth/register:
    $ref: './paths/auth-endpoints.yml#/~1api~1auth~1register'
  /api/auth/login:
    $ref: './paths/auth-endpoints.yml#/~1api~1auth~1login'

  # Group endpoints
  /api/groups:
    $ref: './paths/group-endpoints.yml#/~1api~1groups'
  /api/groups/{id}:
    $ref: './paths/group-endpoints.yml#/~1api~1groups~1{id}'

  # Invitation endpoints
  /api/groups/{groupId}/invite:
    $ref: './paths/invitation-endpoints.yml#/~1api~1groups~1{groupId}~1invite'
  /api/invite/{token}:
    $ref: './paths/invitation-endpoints.yml#/~1api~1invite~1{token}'

  # User group endpoints
  /api/groups/me:
    $ref: './paths/user-group-endpoints.yml#/~1api~1groups~1me'
  /api/groups/{groupId}/users:
    $ref: './paths/user-group-endpoints.yml#/~1api~1groups~1{groupId}~1users'

  # Wish endpoints
  /api/groups/{groupId}/wishes:
    $ref: './paths/wish-endpoints.yml#/~1api~1groups~1{groupId}~1wishes'
  /api/groups/{groupId}/wishes/me:
    $ref: './paths/wish-endpoints.yml#/~1api~1groups~1{groupId}~1wishes~1me'
  /api/groups/{groupId}/wishes/users/{userId}:
    $ref: './paths/wish-endpoints.yml#/~1api~1groups~1{groupId}~1wishes~1users~1{userId}'
  /api/groups/{groupId}/wishes/{wishId}:
    $ref: './paths/wish-endpoints.yml#/~1api~1groups~1{groupId}~1wishes~1{wishId}'
  /api/groups/{groupId}/wishes/{wishId}/reserve:
    $ref: './paths/wish-endpoints.yml#/~1api~1groups~1{groupId}~1wishes~1{wishId}~1reserve'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Token JWT obtenu après inscription/connexion (admin) ou acceptation d'invitation (utilisateur).
        
        Format: `Authorization: Bearer <token>`

  schemas:
    # Schémas de requête
    AuthRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8

    GroupRequest:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
        type:
          type: string
          enum:
            - noël

    InvitationRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email

    WishRequest:
      type: object
      required:
        - giftName
      properties:
        giftName:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
          maxLength: 1000
          nullable: true
        url:
          type: string
          format: uri
          maxLength: 500
          nullable: true

    # Schémas de réponse
    AuthResponse:
      type: object
      required:
        - userId
        - isAdmin
        - token
      properties:
        userId:
          type: string
          format: uuid
        isAdmin:
          type: boolean
        token:
          type: string

    GroupResponse:
      type: object
      required:
        - id
        - name
        - type
        - adminId
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
        adminId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        jwtToken:
          type: string
          nullable: true

    InvitationResponse:
      type: object
      required:
        - id
        - email
        - groupId
        - token
        - accepted
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        groupId:
          type: string
          format: uuid
        token:
          type: string
          format: uuid
        accepted:
          type: boolean
        createdAt:
          type: string
          format: date-time
        invitationLink:
          type: string
          format: uri
          nullable: true
        jwtToken:
          type: string
          nullable: true

    WishResponse:
      type: object
      required:
        - id
        - userId
        - groupId
        - giftName
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        groupId:
          type: string
          format: uuid
        giftName:
          type: string
        description:
          type: string
          nullable: true
        url:
          type: string
          format: uri
          nullable: true
        reservedBy:
          type: string
          format: uuid
          nullable: true
        createdAt:
          type: string
          format: date-time

    UserResponse:
      type: object
      required:
        - id
        - email
        - admin
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        admin:
          type: boolean
        createdAt:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      required:
        - message
        - timestamp
      properties:
        message:
          type: string
        timestamp:
          type: string
          format: date-time

  parameters:
    GroupIdParam:
      name: groupId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    WishIdParam:
      name: wishId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    UserIdParam:
      name: userId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    TokenParam:
      name: token
      in: path
      required: true
      schema:
        type: string
        format: uuid

  responses:
    UnauthorizedError:
      description: Non authentifié - Token JWT manquant ou invalide
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    ForbiddenError:
      description: Accès refusé - Permissions insuffisantes
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Ressource non trouvée
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    BadRequestError:
      description: Requête invalide - Données manquantes ou incorrectes
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'


