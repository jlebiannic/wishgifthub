meta {
  name: Valid - URL optionnelle vide
  type: http
  seq: 4
}

post {
  url: {{base_url}}/api/groups/{{group_id}}/wishes
  body: json
  auth: bearer
}

auth:bearer {
  token: {{user_token}}
}

body:json {
  {
    "giftName": "Produit sans URL",
    "description": "Test avec URL optionnelle"
  }
}

script:post-response {
  if (res.body.id) {
    // Nettoyer en supprimant le souhait créé
    const axios = require('axios');
    axios.delete(
      `${bru.getEnvVar("base_url")}/api/groups/${bru.getEnvVar("group_id")}/wishes/${res.body.id}`,
      {
        headers: {
          'Authorization': `Bearer ${bru.getEnvVar("user_token")}`
        }
      }
    ).catch(() => {});
  }
}

tests {
  test("Status 200 - URL vide acceptée", function() {
    expect(res.getStatus()).to.equal(200);
  });
  
  test("Wish créé sans URL", function() {
    expect(res.body.id).to.be.a('string');
    expect(res.body.giftName).to.equal("Produit sans URL");
  });
  
  test("URL est null", function() {
    expect(res.body.url).to.be.null;
  });
  
  test("Image URL est null", function() {
    expect(res.body.imageUrl).to.be.null;
  });
}

docs {
  Teste qu'un souhait peut être créé sans URL (champs optionnels).
  
  Les champs url et imageUrl sont optionnels selon le schéma OpenAPI.
}
