meta {
  name: Test Security - User tries to create group
  type: http
  seq: 1
}

post {
  url: {{base_url}}/api/groups
  body: json
  auth: bearer
}

auth:bearer {
  token: {{user_token}}
}

body:json {
  {
    "name": "Tentative groupe par user",
    "type": "no√´l"
  }
}

tests {
  test("Status 403 Forbidden", function() {
    expect(res.getStatus()).to.equal(403);
  });

  test("Error message about admin rights", function() {
    const errorMsg = res.body.message || res.body.error || JSON.stringify(res.body);
    const hasAdminError = errorMsg.toLowerCase().includes('admin') ||
                          errorMsg.toLowerCase().includes('acc√®s refus√©');
    expect(hasAdminError).to.be.true;
  });
}

docs {
  üîí Test de s√©curit√© : V√©rifie qu'un utilisateur simple (non-admin) ne peut PAS cr√©er de groupe.

  Pr√©-requis :
  1. Avoir accept√© une invitation (pour avoir un user_token)
  2. Le user doit avoir isAdmin = false (cas normal)

  R√©sultat attendu :
  ‚ùå HTTP 403 Forbidden
  ‚ùå Message : "Acc√®s refus√© : droits administrateur requis"

  ‚úÖ Si ce test √©choue (200 OK), il y a un probl√®me de s√©curit√© !
}

